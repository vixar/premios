@using System.Collections
@using System.Web.UI.WebControls
@using Microsoft.Ajax.Utilities
@using Microsoft.AspNet.Identity
@using Microsoft.AspNet.Identity.EntityFramework
@using ProyectoCalidad.Domain.Concrete
@using ProyectoCalidad.Domain.Entities
@model IEnumerable<ProyectoCalidad.Domain.Entities.GuiaPostulantes>

@{
    /**/

    ViewBag.Title = "Mantenimiento de Criterios";

    var userManager = new UserManager<ApplicationUser>
        (new UserStore<ApplicationUser>
            (new EFDbContext()));
    var user = userManager.FindById(User.Identity.GetUserId());

    int id = 0;
    //var evaluadores = ViewBag.evaluadoresequipo;
    //GuiaPostulantePuntuacion puntuaciones = ViewBag.puntuacion;
    var totales = ViewBag.resultado;
    List<sp_CalcularPuntuacionSubCriteriosPostVisita> SPpuntuacionSubCriterioPostVisita = null;
    List<sp_CalculoPuntuacion> spCalculoPuntuacion = null;

    if (ViewBag.SPpuntuacionSubCriterio != null)
    {
        SPpuntuacionSubCriterioPostVisita = ViewBag.SPpuntuacionSubCriterioPostVisita;

    }

    if (ViewBag.SPpuntuacionCriterio != null)
    {
        spCalculoPuntuacion = ViewBag.SPpuntuacionCriterio;
    }

    var premio = new Premio();

    var criterioSeleccionado = ViewBag.CriterioSeleccionado;

    EvaluadorPremio evaluador = ViewBag.evaluador;

    if (ViewBag.premio != null)
    {
        premio = ViewBag.premio;
    }

    List
        <EvaluadorPremio>
        evaluadores = ViewBag.evaluadoresequipo;
    List<GuiaPostulantePuntuacion>
        puntuacionesPorEvaluadores = ViewBag.puntuacionesPorEvaluadores;

    List<GuiaPostulantePuntuacion> puntuacion = null;
    if (ViewBag.puntuacion != null)
    {
        puntuacion = ViewBag.puntuacion;
    }


}

@section Style
            {
    <!-- Plugin Css-->
    <link rel="stylesheet" href="~/plugins/magnific-popup/css/magnific-popup.css" />

    <!-- Nestable css -->
    <link href="~/plugins/nestable/jquery.nestable.css" rel="stylesheet" />
    <style>

        .containerF {
            bottom: 0;
            position: fixed;
            margin: 1em;
            right: 0px;
        }

        .buttonsF {
            box-shadow: 0px 5px 11px -2px rgba(0, 0, 0, 0.18), 0px 4px 12px -7px rgba(0, 0, 0, 0.15);
            border-radius: 50%;
            display: block;
            width: 56px;
            height: 56px;
            margin: 20px auto 0;
            position: relative;
            -webkit-transition: all .1s ease-out;
            transition: all .1s ease-out;
        }

            .buttonsF:active,
            .buttonsF:focus,
            .buttonsF:hover {
                box-shadow: 0 0 4px rgba(0,0,0,.14), 0 4px 8px rgba(0,0,0,.28);
            }

            .buttonsF:not(:last-child) {
                width: 40px;
                height: 40px;
                margin: 20px auto 0;
                opacity: 0;
                -webkit-transform: translateY(50px);
                -ms-transform: translateY(50px);
                transform: translateY(50px);
            }

        .containerF:hover
        .buttonsF:not(:last-child) {
            opacity: 1;
            -webkit-transform: none;
            -ms-transform: none;
            transform: none;
            margin: 15px auto 0;
            /*background-image: url('../../Images/512.png');*/
        }

        /* Unessential styling for sliding up buttons at differnt speeds */

        .buttonsF:nth-last-child(1) {
            -webkit-transition-delay: 25ms;
            transition-delay: 25ms;
            background-color: white;
            background-size: cover;
            background-image: url('https://mdbootstrap.com/img/svg/hamburger8.svg?color=E3005C');
            background-repeat: no-repeat;
            /*background-size: contain;*/
        }


        .buttonsF:not(:last-child):nth-last-child(2) {
            -webkit-transition-delay: 50ms;
            transition-delay: 20ms;
            background-color: white;
            background-repeat: no-repeat;
            background-image: url('https://cdn.onlinewebfonts.com/svg/img_340225.png');
            background-size: cover;
        }

        .buttonsF:not(:last-child):nth-last-child(3) {
            -webkit-transition-delay: 75ms;
            transition-delay: 40ms;
            background-image: url('../../Images/512.png');
            background-color: white;
            background-repeat: no-repeat;
            /*background-image: url('https://cbwconline.com/IMG/Twitter-Flat.png');*/
            background-size: cover;
        }

        .buttonsF:not(:last-child):nth-last-child(4) {
            -webkit-transition-delay: 100ms;
            transition-delay: 60ms;
            background-image: url('../../Images/142.png');
            /*background-image: url('https://cbwconline.com/IMG/Google%20Plus.svg');*/
            background-size: contain;
            background-color: white;
            background-repeat: no-repeat;
            background-size: cover;
        }

        /* Show tooltip content on hover */

        [tooltip]:before {
            bottom: 25%;
            font-family: arial;
            font-weight: 600;
            border-radius: 2px;
            background: #585858;
            color: #fff;
            content: attr(tooltip);
            font-size: 12px;
            visibility: hidden;
            opacity: 0;
            padding: 5px 7px;
            margin-right: 12px;
            position: absolute;
            right: 100%;
            white-space: nowrap;
        }

        [tooltip]:hover:before,
        [tooltip]:hover:after {
            visibility: visible;
            opacity: 1;
        }
    </style>
}
<h1>@ViewBag.NombreIp</h1>

<h2>&nbsp;<span class="glyphicon glyphicon-tasks"></span>Evaluación Post-Visita  </h2>
<hr />

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title"><span class="glyphicon glyphicon-book"></span> Referencias</h3>
    </div>
    <div class="panel-body">
        <div class="form-horizontal">
            <div class="form-group">
                <div class="col-md-12">
                    <a href="@Url.Action("VerTablaPuntuacion", "Home" , new{premioID=premio.PremioID})" target="_blank" class="btn btn-primary waves-effect waves-light">Tabla de Puntuación</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="">
    <div class="row">
        <div class="col-md-12">
            <div class="card-box">
                <h2 class="header-title m-t-0 m-b-30" style="font-family: 'Oswald', sans-serif;">CRITERIOS</h2>
                @* TABS DE LA GUIA *@
                <ul class="nav nav-tabs navtab-bg" id="criteriosTab" style="font-size: 12px;">
                    @{
                        var active = "";
                        var expanded = "false";
                        var criterios = Model.Select(x => x.CriterioID).Distinct().ToList();
                        for (int i = 0; i < criterios.Count(); i++)
                        {
                            var c = Model.FirstOrDefault(x => x.CriterioID == criterios[i]);
                            if (i == 0) { active = "active"; expanded = "true"; } else { active = ""; expanded = "false"; }
                            <li class="@active">
                                <a href="#criterio-@c.CriterioID" data-toggle="tab" aria-expanded="@expanded">
                                    <span class="visible-xs"><i class="fa fa-home"></i></span>
                                    <span class="hidden-xs" style="font-weight: bolder">Criterio -@c.CriterioCodigo</span>
                                </a>
                            </li>
                        }
                    }
                </ul>
                <div class="tab-content">

                @{
                    List<Criterio> Criterios = ViewBag.criterios;
                    
                        var num = 0;
                        foreach (var c in Criterios)
                        {
                            if (num == 0) { active = "active"; } else { active = ""; }
                            num++;
                            //var c = Model.FirstOrDefault(x => x.CriterioID == criterios[i]);
                            
                            <div class="tab-pane @active" id="criterio-@c.CriterioID">
                                <div class="" style="background-color:#ffffff">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h4 class="m-t-0 header-title" style="font-family: 'Oswald', sans-serif;"><b>@c.Codigo - @c.Nombre</b></h4>
                                            <p class="text-muted m-b-30" style="font-size: 15px">
                                                @c.Descripcion

                                            </p>
                                        </div>
                                    </div>

                                    <div class="row">

                                        <div class="col-md-6">
                                            <table class="table table-bordered">

                                                <thead class="bg-primary">
                                                    @if (evaluador.IsManager)
                                                    {

                                                        <tr>

                                                            @if (c.Codigo == "6" || c.Codigo == "7" || c.Codigo == "8" || c.Codigo == "9")
                                                            {
                                                                <th style="width: 20%">
                                                                    SubCriterio
                                                                </th>
                                                                <th>
                                                                    TENDENCIAS
                                                                </th>
                                                                <th>
                                                                    OOBJETIVOS
                                                                </th>

                                                                @*<th>
                                                                        C
                                                                    </th>
                                                                    <th>
                                                                        A
                                                                    </th>*@
                                                            }
                                                            else
                                                            {
                                                                <th style="width: 20%">
                                                                    SubCriterio
                                                                </th>
                                                                <th>
                                                                    P
                                                                </th>
                                                                <th>
                                                                    D
                                                                </th>
                                                                <th>
                                                                    C
                                                                </th>
                                                                <th>
                                                                    A
                                                                </th>
                                                            }

                                                        </tr>
                                                    }
                                                    else
                                                    {
                                                        <tr>
                                                            @if (c.Codigo == "6" || c.Codigo == "7" || c.Codigo == "8" || c.Codigo == "9")
                                                            {
                                                                <th style="width: 20%">
                                                                    SubCriterio
                                                                </th>
                                                                <th>
                                                                    TENDENCIAS
                                                                </th>
                                                                <th>
                                                                    OOBJETIVOS
                                                                </th>

                                                                @*<th>
                                                                        C
                                                                    </th>
                                                                    <th>
                                                                        A
                                                                    </th>*@
                                                            }
                                                            else
                                                            {
                                                                <th style="width: 20%">
                                                                    SubCriterio
                                                                </th>
                                                                <th>
                                                                    P
                                                                </th>
                                                                <th>
                                                                    D
                                                                </th>
                                                                <th>
                                                                    C
                                                                </th>
                                                                <th>
                                                                    A
                                                                </th>
                                                            }


                                                        </tr>

                                                    }

                                                </thead>
                                                <tbody>
                                                    @if (SPpuntuacionSubCriterioPostVisita != null)
                                                    {
                                                        foreach (var item in SPpuntuacionSubCriterioPostVisita)
                                                        {
                                                            if (evaluador.IsManager)
                                                            {
                                                                if (item.CriterioID == c.CriterioID && item.EvaluadorID == evaluador.EvaluadorPremioID)
                                                                {
                                                                    <tr>

                                                                        <td>
                                                                            @item.SubCriterioCodigo
                                                                        </td>
                                                                        @if (c.Codigo == "6" || c.Codigo == "7" || c.Codigo == "8" || c.Codigo == "9")
                                                                        {
                                                                            <td>
                                                                                @item.PuntuacionPPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionDPostVisita
                                                                            </td>


                                                                            @*<td>
                                                                                    @item.PuntuacionC
                                                                                </td>
                                                                                <td>
                                                                                    @item.PuntuacionA
                                                                                </td>*@
                                                                        }
                                                                        else
                                                                        {

                                                                            <td>
                                                                                @item.PuntuacionPPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionDPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionCPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionAPostVisita
                                                                            </td>
                                                                        }


                                                                    </tr>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                if (item.CriterioID == c.CriterioID && item.EvaluadorID == evaluador.EvaluadorPremioID)
                                                                {
                                                                    <tr>
                                                                        <td>
                                                                            @item.SubCriterioCodigo
                                                                        </td>
                                                                        @if (c.Codigo == "6" || c.Codigo == "7" || c.Codigo == "8" || c.Codigo == "9")
                                                                        {
                                                                            <td>
                                                                                @item.PuntuacionPPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionDPostVisita
                                                                            </td>


                                                                            @*<td>
                                                                                    @item.PuntuacionC
                                                                                </td>
                                                                                <td>
                                                                                    @item.PuntuacionA
                                                                                </td>*@
                                                                        }
                                                                        else
                                                                        {

                                                                            <td>
                                                                                @item.PuntuacionPPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionDPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionCPostVisita
                                                                            </td>
                                                                            <td>
                                                                                @item.PuntuacionAPostVisita
                                                                            </td>
                                                                        }


                                                                    </tr>

                                                                }
                                                            }

                                                        }
                                                    }
                                                    @*@foreach (var p in puntuaciones)
                                                        {
                                                            <tr>
                                                                <td>
                                                                    subcriterio
                                                                </td>
                                                                <td>
                                                                    @p.
                                                                </td>
                                                            </tr>
                                                        }*@

                                                </tbody>
                                                @*<tfoot>
                                                        <tr>
                                                        <tr>
                                                            <td>
                                                                Total
                                                            </td>
                                                            <td colspan="4" class="text-center">
                                                                @Convert.ToInt32(spCalculoPuntuacion.Where(x => x.CriterioID == c.CriterioID).Select(x => x.PuntuacionTotal).FirstOrDefault())
                                                            </td>
                                                        </tr>
                                                        </tr>
                                                    </tfoot>*@
                                            </table>
                                        </div>
                                        <!--TABLA DE PUNTUECIONES DEL EVALUADOR-->

                                    </div>
                                    <!--end criterio-->
                                    @{
                                        var allSub = Model.Where(x => x.CriterioID == c.CriterioID);
                                        var sub = allSub.DistinctBy(x => new { x.SubCriterioID, x.SubCriterioDescripcion, x.SubCriterioCodigo });
                                      

                                        foreach (var s in sub.OrderBy(x => x.SubCriterioCodigo))
                                        {
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <hr />
                                                    <h2 class="m-t-0 header-title">

                                                        <b>@s.SubCriterioCodigo - @s.SubCriterioDescripcion </b>
                                                        <br />
                                                        <br />
                                                        @if (string.IsNullOrEmpty(ViewBag.postvisita))
                                                        {
                                                            <a class="btn btn-primary m-b-15" href="@Url.Action("puntuarSubCriterio", "GuiaPostulantes", new {GuiaPostulantePuntuacionID = puntuacion.Where(x => x.SubCriterioID == s.SubCriterioID &&  ViewBag.evaluador.UsuarioID  == user.Id).Select(x => x.GuiaPostulantePuntuacionID).First(), criterioID = c.Codigo, vista = "POST"})">PUNTUAR SUBCRITERIO<i class="mdi mdi-pencil-box"></i></a>
                                                            @*<a class="btn btn-primary m-b-15" href="@Url.Action("puntuarSubCriterio", "GuiaPostulantes", new {GuiaPostulantePuntuacionID = puntuacionesPorEvaluadores.Where(x => x.SubCriterioID == s.SubCriterioID).Select(x => x.GuiaPostulantePuntuacionID).FirstOrDefault(), criterioID = c.CriterioCodigo})">PUNTUAR SUBCRITERIO<i class="mdi mdi-pencil-box"></i></a>*@
                                                            @*<button class="btn btn-primary m-b-15 pull-right" onclick="createModal('@Url.Action("puntuarSubCriterio", "GuiaPostulantes", new {GuiaPostulantePuntuacionID = puntuacionesPorEvaluadores.Where(x => x.SubCriterioID == s.SubCriterioID).Select(x => x.GuiaPostulantePuntuacionID).FirstOrDefault(), criterioID = c.CriterioCodigo})')">PUNTUAR SUBCRITERIO <i class="mdi mdi-pencil-box"></i></button>*@
                                                            <a class="btn btn-primary m-b-15" href="@Url.Action("IniciarEvaluacion", new {subCriterioID = s.SubCriterioID, InstitucionPostulanteID = s.InstitucionPostulanteID, criterioSeleccionado = c.CriterioID})"><i class="mdi mdi-clipboard-text"></i> REVISAR / EVALUAR EVIDENCIAS </a>

                                                        }
                                                        else
                                                        {
                                                            <a class="btn btn-primary m-b-15 disabled" style="cursor: not-allowed" href="@Url.Action("puntuarSubCriterio", "GuiaPostulantes", new {GuiaPostulantePuntuacionID = puntuacion.Where(x => x.SubCriterioID == s.SubCriterioID &&  ViewBag.evaluador.UsuarioID  == user.Id).Select(x => x.GuiaPostulantePuntuacionID).First(), criterioID = c.Codigo})">PUNTUAR SUBCRITERIO<i class="mdi mdi-pencil-box"></i></a>
                                                            @*<a class="btn btn-primary m-b-15" href="@Url.Action("puntuarSubCriterio", "GuiaPostulantes", new {GuiaPostulantePuntuacionID = puntuacionesPorEvaluadores.Where(x => x.SubCriterioID == s.SubCriterioID).Select(x => x.GuiaPostulantePuntuacionID).FirstOrDefault(), criterioID = c.CriterioCodigo})">PUNTUAR SUBCRITERIO<i class="mdi mdi-pencil-box"></i></a>*@
                                                            @*<button class="btn btn-primary m-b-15 pull-right" onclick="createModal('@Url.Action("puntuarSubCriterio", "GuiaPostulantes", new {GuiaPostulantePuntuacionID = puntuacionesPorEvaluadores.Where(x => x.SubCriterioID == s.SubCriterioID).Select(x => x.GuiaPostulantePuntuacionID).FirstOrDefault(), criterioID = c.CriterioCodigo})')">PUNTUAR SUBCRITERIO <i class="mdi mdi-pencil-box"></i></button>*@
                                                            <a class="btn btn-primary m-b-15 disabled" style="cursor: not-allowed" href="@Url.Action("IniciarEvaluacion", new {subCriterioID = s.SubCriterioID, InstitucionPostulanteID = s.InstitucionPostulanteID, criterioSeleccionado = c.CriterioID})"><i class="mdi mdi-clipboard-text"></i> REVISAR / EVALUAR EVIDENCIAS </a>

                                                        }

                                                    </h2>
                                                </div>
                                            </div>

                                        }
                                    }

                                    <!--end loop subcriterios-->
                                </div>
                            </div>

                        }

                    }
                </div>

            </div>
        </div> <!-- end col -->
    </div>
    <div class="row">
        <div class="col-md-12">





            <!--end loop criterios-->

        </div>

        <!-- end row -->

        <div class="hidden-print">

        </div>

    </div>
    <!--end col-->
    @*}*@
</div>

<!--MENU FLOTANTE-->
@*<nav class="containerF">

        <a href="#" class="buttonsF" tooltip="Disminuir" onclick="colapsar()"></a>

        <a href="#" class="buttonsF" tooltip="Expandir" onclick="expandir()"></a>

        <a href class="buttonsF" tooltip="Subir" onclick="topFunction()"></a>

        <a class="buttonsF" tooltip="Share" href="#"></a>

    </nav>*@

<!--FIN MENU FLOTANTE-->
@*<div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><span class="glyphicon glyphicon-search"></span> Memoria</h3>

        </div>
    </div>*@

@*<div class="container">
    <div class="row">
        <div class="col-sm-12">

            @{
            var criterios = Model.Select(x => x.CriterioID).Distinct().ToList();

            for (int i = 0; i < criterios.Count(); i++)
            {

            var c = Model.FirstOrDefault(x => x.CriterioID == criterios[i]);

            <div class="card-box" style="background-color:#02000003">
                <div class="row">
                    <div class="col-md-12">
                        <h3 class="m-t-0 header-title"><b>@c.CriterioCodigo - @c.CriterioNombre</b></h3>
                        <p class="text-muted m-b-30 font-13">
                            @c.CriterioDescripcion
                        </p>
                        @if (totales != null)
                        {
                        if (user.Role == "COORDINADOR-EVALUADOR-EXTERNO" || user.Role == "JURADO" || user.Role == "ADMIN")
                        {
                        if (c.CriterioID == totales[i].CriterioID)
                        {
                        <div class="col-md-2">
                            <div class="card-box">
                                <h1>@Math.Ceiling(totales[i].PuntuacionTotal)<small> Puntos</small></h1>
                            </div>
                        </div>

                        }
                        }

                        }

                    </div>

                </div>

                <hr />
                <!--end criterio-->
                @{
                var sub = Model.Where(x => x.CriterioID == c.CriterioID).DistinctBy(x => new { x.SubCriterioID, x.SubCriterioDescripcion, x.SubCriterioCodigo }).ToList();

                foreach (var s in sub)
                {
                <div class="row">
                    <div class="col-md-12">
                        <hr />
                        <h3 class="m-t-0 header-title"><b>@s.SubCriterioCodigo - @s.SubCriterioDescripcion </b></h3>

                        <hr />

                        @if (user.Role == "EVALUADOR-EXTERNO")
                        {
                        <div class="col-md-12">

                            <div class="panel panel-primary">
                                <table class="table table-bordered table-striped table-hover">
                                    <thead class="bg-primary text-white">
                                        <tr>
                                            <th class="text-center">
                                                Puntiación P
                                            </th>
                                            <th class="text-center">
                                                Puntiación D
                                            </th>
                                            <th class="text-center">
                                                Puntiación C
                                            </th>
                                            <th class="text-center">
                                                Puntiación A
                                            </th>
                                            <th class="text-center">
                                                Comentario
                                            </th>
                                            <th class="text-center">
                                                Nombre Evaluador
                                            </th>
                                            <th class="text-center">
                                                Acción
                                            </th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        @foreach (var item in puntuaciones)
                                        {

                                        if (item != null)
                                        {
                                        if (s.SubCriterioID == item.SubCriterioID)
                                        {
                                        <tr>
                                            <td>@item.PuntuacionP</td>
                                            <td>@item.PuntuacionD</td>
                                            <td>@item.PuntuacionC</td>
                                            <td>@item.PuntuacionA</td>
                                            <td>@item.Comentario</td>
                                            <td>@item.NombreEvaluador</td>
                                            <td>
                                                @if (ViewBag.puntuacion != null)
                                                {
                                                <button class="btn btn-primary m-b-15" onclick="createModal('@Url.Action(" puntuarSubCriterio", "GuiaPostulantes" , new {GuiaPostulantePuntuacionID=item.GuiaPostulantePuntuacionID})')">Evaluar <i class="mdi mdi-pencil-box"></i></button>

                                                }
                                                else
                                                {
                                                <button class="btn btn-primary m-b-15" onclick="createModal('@Url.Action(" puntuarSubCriterio", "GuiaPostulantes" , new {GuiaPostulantePuntuacionID=item.GuiaPostulantePuntuacionID})')">Editar <i class="mdi mdi-pencil-box"></i></button>

                                                }
                                            </td>

                                        </tr>
                                        }

                                        }
                                        }

                                    </tbody>
                                </table>
                            </div>
                        </div>
                        }


                        <div class="row">
                            <div class="col-lg-12 col-md-6">
                                <div class="card-box">
                                    @{
                                    var ejes = Model.Where(x => x.SubCriterioID == s.SubCriterioID).DistinctBy(x => new { x.EjemploID, x.EmeploDescripcion, x.EmeploCodigo }).ToList();

                                    var total = ejes.Count;
                                    var conteo = ejes.Count;

                                    foreach (var e in ejes)
                                    {
                                    if (e.PuntosFuertes == null)
                                    {
                                    conteo--;
                                    }


                                    }
                                    }

                                    <div class="pull-right">
                                        Ejemeplos completos: ( @conteo / @total )
                                    </div>
                                    <table class="table table-bordered table-striped">
                                        <thead class="bg-primary text-white">
                                            <tr class="table-primary text-center">
                                                <th style="text-align: center;" class="col-lg-1 ">#</th>
                                                <th style="text-align: center;">Ejemplos</th>
                                                <th style="text-align: center;">Puntos Fuertes <br />(Detallar Evidencias)</th>
                                                <th style="text-align: center;">Áreas de Mejora</th>
                                                @if (user.Role == "POSTULANTE")
                                                {
                                                <th style="text-align: center;">Llenar ejemplo</th>

                                                <th style="text-align: center;">Evidencia</th>

                                                }
                                                else
                                                {
                                                <th style="text-align: center;" class="col-sm-2">Ver Evidencias</th>
                                                }

                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{

                                            var ejemplos = Model.Where(x => x.SubCriterioID == s.SubCriterioID).DistinctBy(x => new { x.EjemploID, x.EmeploDescripcion, x.EmeploCodigo }).ToList();
                                            foreach (var e in ejemplos)
                                            {
                                            <tr>
                                                <td style="text-align: center;" class="col-lg-1" scope="row">@e.EmeploCodigo </td>
                                                <td style="width: 15px; text-align: center;">@e.EmeploDescripcion</td>
                                                <td style="width: 50%; text-align: center;">@e.PuntosFuertes</td>
                                                <td style="width: 50%; text-align: center;">@e.AreadeMejoras</td>
                                                @if (user.Role == "POSTULANTE")
                                                {
                                                @*
                                                <td class="actions">
                                                    <a href="#" class="hidden on-editing save-row"><i class="fa fa-save"></i></a>
                                                    <a href="#" class="hidden on-editing cancel-row"><i class="fa fa-times"></i></a>
                                                    <a href="#" class="on-default edit-row"><i class="fa fa-pencil"></i></a>
                                                    <a href="#" class="on-default remove-row"><i class="fa fa-trash-o"></i></a>
                                                </td>*@@*

                                                <td class="col-sm-2"><button class="btn btn-primary" onclick="createModal('@Url.Action(" EditarEjemplo", "GuiaPostulantes" , new {id=e.EjemploID, guiaPostulanteID=e.GuiaPostulanteID})')"><i class="fa fa-edit"></i></button></td>

                                                <td><a class="btn btn-primary" href="@Url.Action(" VerEvidencia", "GuiaPostulantes" , new {id=e.EjemploID, guiaPostulanteID=e.GuiaPostulanteID})">Evidencia</a></td>



                                                }
                                                else
                                                {
                                                <td class="col-sm-2"><button class="btn btn-primary" onclick="createModal('@Url.Action(" EditarEjemplo", "GuiaPostulantes" , new {id=e.EjemploID, guiaPostulanteID=e.GuiaPostulanteID})')"><i class="fa fa-edit"></i></button></td>
                                                }

                                            </tr>
                                            }

                                            }
                                        </tbody>
                                    </table>

                                </div>
                            </div>

                            @{
                            id = s.InstitucionPostulanteID;
                            }

                        </div>
                    </div>
                </div>
                }
                }



                <!--end loop subcriterios-->
            </div>

            }
            }


            <!--end loop criterios-->

        </div>

        <!-- end row -->

        <div class="hidden-print">

        </div>

    </div>
    <!--end col-->
    @*}*@@*
                                                    </div>*@

    @if (user.Role != "POSTULANTE")
    {
        @section sideMenu
            {

            <ul class="nav navbar-nav navbar-left">
                <li>
                    <button class="button-menu-mobile open-left waves-effect waves-light">
                        <i class="mdi mdi-menu"></i>
                    </button>
                </li>
                @*
                    <li class="hidden-xs">@Html.ActionLink("Crear Guia Postulante", "EditarGuiaPostulante", null, new { @class = "menu-item waves-effect waves-light" })</li>*@
                <li class="hidden-xs">@Html.ActionLink("Inicio", "Index", "Home", null, new { @class = "menu-item waves-effect waves-light" })</li>
            </ul>
        }
    }



    @section modals
            {

        <div class="modal fade" id="myModal" role="dialog" tabindex="-1" aria-labelledby="myModalLabel">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" id="modelContent">
                </div>
            </div>
        </div>


        <!-- Modal -->
        <div id="custom-modal" class="modal-demo">
            <button type="button" class="close" onclick="Custombox.close();">
                <span>&times;</span><span class="sr-only">Close</span>
            </button>
            <h4 class="custom-modal-title">Add New Agent</h4>
            <div class="custom-modal-text text-left">


                <form>


                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" placeholder="Enter name">
                    </div>

                    <div class="form-group">
                        <label for="exampleInputEmail1">Email address</label>
                        <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Enter email">
                    </div>

                    <div class="form-group">
                        <label for="position">Contact number</label>
                        <input type="text" class="form-control" id="position" placeholder="Enter number">
                    </div>


                    <button type="submit" class="btn btn-default waves-effect waves-light">Save</button>
                    <button type="button" class="btn btn-danger waves-effect waves-light m-l-10">Cancel</button>
                </form>




            </div>
        </div>

    }

    @section scripts
            {
        <!--Wysiwig js-->
        <script src="~/plugins/tinymce/tinymce.min.js"></script>
        <!-- Modal-Effect -->
        <script src="~/plugins/custombox/js/custombox.min.js"></script>
        <script src="~/plugins/custombox/js/legacy.min.js"></script>


        <!-- Examples -->
        <script src="~/plugins/magnific-popup/js/jquery.magnific-popup.min.js"></script>
        <script src="~/plugins/jquery-datatables-editable/jquery.dataTables.js"></script>
        <script src="~/plugins/datatables/dataTables.bootstrap.js"></script>
        <script src="~/plugins/tiny-editable/mindmup-editabletable.js"></script>
        <script src="~/plugins/tiny-editable/numeric-input-example.js"></script>
        <script src="~/Plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js"></script>
        <script src="~/plugins/sweetalert2.all.min.js"></script>
        <script src="~/Scripts/pages/jquery.datatables.editable.init.js"></script>

        <script>
    $('#mainTable').editableTableWidget().numericInputExample().find('td:first').focus();

    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
            document.getElementById("myBtn").style.display = "block";
        } else {
            document.getElementById("myBtn").style.display = "none";
        }
    }

    function expandir() {
        $(".expanded").show(600);
    }
    function colapsar() {
        $(".expanded").hide(600);
    }
    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }

    $(document).ready(function () {


                    var criterio = 'criterio-' + '@criterioSeleccionado';

                    activaTab(criterio);

                    function activaTab(tab) {
                        $('.nav-tabs a[href="#' + tab + '"]').tab('show');
                    };

                    @* function wys(evaluadorID, ejemploID, guiaPostulanteID, institucionPostulanteID) {

                        //debugger;
                        var tAreaValue0;
                        var tAreaValue1;
                        var tAreaValue2;
                        var id2 = institucionPostulanteID;
                        var id = id2;

                        var url = "@Url.Action("GuardarComentariosEvaluadoresJsono", "GuiaPostulantes")";

                        var url = url + "?InstitucionPostulanteID=" + institucionPostulanteID;

                        for (i = 0; i < tinymce.editors.length; i++) {
                            var content = tinymce.editors[i].getContent();
                            if (i === 0) {
                                tAreaValue0 = content;
                            }
                            if (i === 1) {
                                tAreaValue1 = content;

                            }
                            if (i === 2) {
                                tAreaValue2 = content;

                            }
                            //var txtAreaID = tinyMCE.editors[i].id;
                        }

                        var model = {
                            EvaluadorID: evaluadorID,
                            EjemploID: ejemploID,
                            GuiaPostulanteID: guiaPostulanteID,
                            Fortalezas: tAreaValue0,
                            InformRetorno: tAreaValue1,
                            PuntoDeVista: tAreaValue2
                        }

                        $.ajax({
                            url: url,
                            type: "POST",
                            //contentType: "application/json",
                            data: model,
                            success: function (response) {
                                if (response) {
                                    Swal.fire({
                                        title: "Comentarios actualizados",
                                        html: "Los campos fueron actualizados correctamente",
                                        type: "success"
                                    });

                                }
                                setTimeout(function () {
                                    location.reload();

                                },
                                    2000);
                            }
                        });


                    }

                    //$(":file").filestyle({ buttonText: "Seleccionar Memoria" });


                    //var el = $("#elm1").val();
                    //console.log(el);
                    if ($("#elm1").length > 0) {
                        tinymce.init({
                            selector: "#elm1",
                            theme: "modern",
                            height: 100,
                            width: 500,
                            plugins: [
                                "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                                "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                                "save table contextmenu directionality emoticons template paste textcolor"
                            ],
                            toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
                            style_formats: [
                                { title: 'Bold text', inline: 'b' },
                                { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } },
                                { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } },
                                { title: 'Example 1', inline: 'span', classes: 'example1' },
                                { title: 'Example 2', inline: 'span', classes: 'example2' },
                                { title: 'Table styles' },
                                { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }
                            ]
                        });
                    }

                    if ($("#elm2").length > 0) {
                        tinymce.init({
                            selector: "#elm2",
                            theme: "modern",
                            height: 100,
                            width: 500,
                            plugins: [
                                "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                                "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                                "save table contextmenu directionality emoticons template paste textcolor"
                            ],
                            toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
                            style_formats: [
                                { title: 'Bold text', inline: 'b' },
                                { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } },
                                { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } },
                                { title: 'Example 1', inline: 'span', classes: 'example1' },
                                { title: 'Example 2', inline: 'span', classes: 'example2' },
                                { title: 'Table styles' },
                                { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }
                            ]
                        });
                    }

                    if ($("#elm3").length > 0) {
                        tinymce.init({
                            selector: "#elm3",
                            theme: "modern",
                            height: 100,
                            width: 500,
                            plugins: [
                                "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                                "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                                "save table contextmenu directionality emoticons template paste textcolor"
                            ],
                            toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
                            style_formats: [
                                { title: 'Bold text', inline: 'b' },
                                { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } },
                                { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } },
                                { title: 'Example 1', inline: 'span', classes: 'example1' },
                                { title: 'Example 2', inline: 'span', classes: 'example2' },
                                { title: 'Table styles' },
                                { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }
                            ]
                        });
                    }*@



            });


                function createModal(url) {
                    console.log('estoy aqui');
                    $('#modelContent').load(url);
                    $('#myModal').modal('show');
                }
        </script>
    }
